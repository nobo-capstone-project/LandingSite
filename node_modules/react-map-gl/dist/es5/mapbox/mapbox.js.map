{"version":3,"sources":["../../../src/mapbox/mapbox.js"],"names":["noop","propTypes","container","PropTypes","object","gl","mapboxApiAccessToken","string","attributionControl","bool","preserveDrawingBuffer","reuseMaps","transformRequest","func","mapOptions","mapStyle","oneOfType","visible","onLoad","onError","width","number","height","viewState","longitude","latitude","zoom","bearing","pitch","altitude","defaultProps","document","body","getAccessToken","accessToken","window","location","match","search","process","env","MapboxAccessToken","REACT_APP_MAPBOX_ACCESS_TOKEN","checkPropTypes","props","component","debug","Mapbox","mapboxgl","Error","initialized","console","VERSION","version","_checkStyleSheet","_initialize","_destroy","_update","_map","resize","isStyleLoaded","_render","savedMap","oldContainer","getContainer","newContainer","classList","add","childNodes","length","appendChild","_container","setStyle","getContext","HTMLCanvasElement","prototype","center","maxZoom","style","interactive","trackResize","Map","Object","assign","once","on","remove","_create","defineProperty","get","canvas","getCanvas","outline","_updateMapViewport","_updateMapSize","oldProps","newProps","sizeChanged","oldViewState","_getViewState","newViewState","viewportChanged","jumpTo","_getMapboxViewStateProps","transform","mapboxVersion","testElement","createElement","className","display","append","isCssLoaded","getComputedStyle","position","link","setAttribute","head","error"],"mappings":"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","sourcesContent":["// @flow\n// Copyright (c) 2015 Uber Technologies, Inc.\n\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* global window, process, HTMLCanvasElement */\nimport PropTypes from 'prop-types';\nimport {document} from '../utils/globals';\n\nfunction noop() {}\n\nconst propTypes = {\n  // Creation parameters\n  container: PropTypes.object, /** The container to have the map. */\n  gl: PropTypes.object, /** External WebGLContext to use */\n\n  mapboxApiAccessToken: PropTypes.string, /** Mapbox API access token for Mapbox tiles/styles. */\n  attributionControl: PropTypes.bool, /** Show attribution control or not. */\n  preserveDrawingBuffer: PropTypes.bool, /** Useful when you want to export the canvas as a PNG. */\n  reuseMaps: PropTypes.bool,\n  transformRequest: PropTypes.func, /** The transformRequest callback for the map */\n  mapOptions: PropTypes.object, /** Extra options to pass to Mapbox constructor. See #545. **/\n  mapStyle: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.object\n  ]), /** The Mapbox style. A string url to a MapboxGL style */\n\n  visible: PropTypes.bool, /** Whether the map is visible */\n\n  onLoad: PropTypes.func, /** The onLoad callback for the map */\n  onError: PropTypes.func, /** The onError callback for the map */\n\n  // Map view state\n  width: PropTypes.number, /** The width of the map. */\n  height: PropTypes.number, /** The height of the map. */\n\n  viewState: PropTypes.object, /** object containing lng/lat/zoom/bearing/pitch */\n\n  longitude: PropTypes.number, /** The longitude of the center of the map. */\n  latitude: PropTypes.number, /** The latitude of the center of the map. */\n  zoom: PropTypes.number, /** The tile zoom level of the map. */\n  bearing: PropTypes.number, /** Specify the bearing of the viewport */\n  pitch: PropTypes.number, /** Specify the pitch of the viewport */\n  // Note: Non-public API, see https://github.com/mapbox/mapbox-gl-js/issues/1137\n  altitude: PropTypes.number /** Altitude of the viewport camera. Default 1.5 \"screen heights\" */\n};\n\nconst defaultProps = {\n  container: document.body,\n  mapboxApiAccessToken: getAccessToken(),\n  preserveDrawingBuffer: false,\n  attributionControl: true,\n  reuseMaps: false,\n  mapOptions: {},\n  mapStyle: 'mapbox://styles/mapbox/light-v8',\n\n  visible: true,\n\n  onLoad: noop,\n  onError: noop,\n\n  width: 0,\n  height: 0,\n  longitude: 0,\n  latitude: 0,\n  zoom: 0,\n  bearing: 0,\n  pitch: 0\n};\n\ntype MapboxGL = {\n  version: string,\n  accessToken: string,\n  Map: Function\n};\n\nexport type ViewState = {\n  longitude: number,\n  latitude: number,\n  zoom: number,\n  bearing: number,\n  pitch: number,\n  altitude?: number\n};\n\ntype Props = {\n  mapboxgl?: MapboxGL,\n  container: any,\n  gl?: any,\n  mapboxApiAccessToken: string,\n  attributionControl: boolean,\n  preserveDrawingBuffer: boolean,\n  onLoad: Function,\n  onError: Function,\n  reuseMaps: boolean,\n  transformRequest?: Function,\n  mapStyle: any,\n  visible: boolean,\n  width: number,\n  height: number,\n  viewState?: ViewState,\n  longitude: number,\n  latitude: number,\n  zoom: number,\n  bearing: number,\n  pitch: number,\n  altitude?: number,\n  mapOptions: any\n};\n\n// Try to get access token from URL, env, local storage or config\nexport function getAccessToken() : string {\n  let accessToken = null;\n\n  if (typeof window !== 'undefined' && window.location) {\n    const match = window.location.search.match(/access_token=([^&\\/]*)/);\n    accessToken = match && match[1];\n  }\n\n  if (!accessToken && typeof process !== 'undefined') {\n    // Note: This depends on bundler plugins (e.g. webpack) importing environment correctly\n    accessToken = accessToken || process.env.MapboxAccessToken || process.env.REACT_APP_MAPBOX_ACCESS_TOKEN; // eslint-disable-line\n  }\n\n  // Prevents mapbox from throwing\n  return accessToken || 'no-token';\n}\n\n// Helper function to merge defaultProps and check prop types\nfunction checkPropTypes(props, component = 'component') {\n  // TODO - check for production (unless done by prop types package?)\n  if (props.debug) {\n    PropTypes.checkPropTypes(propTypes, props, 'prop', component);\n  }\n}\n\n// A small wrapper class for mapbox-gl\n// - Provides a prop style interface (that can be trivially used by a React wrapper)\n// - Makes sure mapbox doesn't crash under Node\n// - Handles map reuse (to work around Mapbox resource leak issues)\n// - Provides support for specifying tokens during development\n\nexport default class Mapbox {\n\n  static initialized : boolean = false;\n  static propTypes : any = propTypes;\n  static defaultProps : any = defaultProps;\n  static savedMap : any = null;\n\n  constructor(props: Props) {\n    if (!props.mapboxgl) {\n      throw new Error('Mapbox not available');\n    }\n\n    this.mapboxgl = props.mapboxgl;\n\n    if (!Mapbox.initialized && console.debug) { // eslint-disable-line\n      Mapbox.initialized = true;\n\n      // Version detection using babel plugin\n      /* global __VERSION__ */\n      // $FlowFixMe\n      const VERSION = typeof __VERSION__ !== 'undefined' ? __VERSION__ : 'untranspiled source';\n\n      console.debug(`react-map-gl: ${VERSION} using mapbox-gl v${this.mapboxgl.version}`); // eslint-disable-line\n\n      this._checkStyleSheet(this.mapboxgl.version);\n    }\n\n    this._initialize(props);\n  }\n\n  mapboxgl : MapboxGL;\n  props : Props = defaultProps;\n  _map : any = null;\n  width : number = 0;\n  height : number = 0;\n\n  finalize() {\n    this._destroy();\n    return this;\n  }\n\n  setProps(props: Props) {\n    this._update(this.props, props);\n    return this;\n  }\n\n  // Mapbox's map.resize() reads size from DOM, so DOM element must already be resized\n  // In a system like React we must wait to read size until after render\n  // (e.g. until \"componentDidUpdate\")\n  resize() {\n    this._map.resize();\n    // map render will throw error if style is not loaded\n    if (this._map.isStyleLoaded()) {\n      this._map._render();\n    }\n    return this;\n  }\n\n  // External apps can access map this way\n  getMap() {\n    return this._map;\n  }\n\n  // PRIVATE API\n\n  _create(props: Props) {\n    // Reuse a saved map, if available\n    if (props.reuseMaps && Mapbox.savedMap) {\n      this._map = Mapbox.savedMap;\n      // When reusing the saved map, we need to reparent the map(canvas) and other child nodes\n      // intoto the new container from the props.\n      // Step1: reparenting child nodes from old container to new container\n      const oldContainer = this._map.getContainer();\n      const newContainer = props.container;\n      newContainer.classList.add('mapboxgl-map');\n      while (oldContainer.childNodes.length > 0) {\n        newContainer.appendChild(oldContainer.childNodes[0]);\n      }\n      // Step2: replace the internal container with new container from the react component\n      this._map._container = newContainer;\n      Mapbox.savedMap = null;\n\n      // Update style\n      if (props.mapStyle) {\n        this._map.setStyle(props.mapStyle);\n      }\n\n      // TODO - need to call onload again, need to track with Promise?\n      props.onLoad();\n    } else {\n      if (props.gl) {\n        const getContext = HTMLCanvasElement.prototype.getContext;\n        // Hijack canvas.getContext to return our own WebGLContext\n        // This will be called inside the mapboxgl.Map constructor\n        // $FlowFixMe\n        HTMLCanvasElement.prototype.getContext = () => {\n          // Unhijack immediately\n          // $FlowFixMe\n          HTMLCanvasElement.prototype.getContext = getContext;\n          return props.gl;\n        };\n      }\n\n      const mapOptions : any = {\n        container: props.container,\n        center: [0, 0],\n        zoom: 8,\n        pitch: 0,\n        bearing: 0,\n        maxZoom: 24,\n        style: props.mapStyle,\n        interactive: false,\n        trackResize: false,\n        attributionControl: props.attributionControl,\n        preserveDrawingBuffer: props.preserveDrawingBuffer\n      };\n      // We don't want to pass a null or no-op transformRequest function.\n      if (props.transformRequest) {\n        mapOptions.transformRequest = props.transformRequest;\n      }\n      this._map = new this.mapboxgl.Map(\n        Object.assign({}, mapOptions, props.mapOptions));\n\n      // Attach optional onLoad function\n      this._map.once('load', props.onLoad);\n      this._map.on('error', props.onError);\n    }\n\n    return this;\n  }\n\n  _destroy() {\n    if (!this._map) {\n      return;\n    }\n\n    if (!Mapbox.savedMap) {\n      Mapbox.savedMap = this._map;\n    } else {\n      this._map.remove();\n    }\n    this._map = null;\n  }\n\n  _initialize(props: Props) {\n    props = Object.assign({}, defaultProps, props);\n    checkPropTypes(props, 'Mapbox');\n\n    // Creation only props\n    this.mapboxgl.accessToken = props.mapboxApiAccessToken || defaultProps.mapboxApiAccessToken;\n\n    this._create(props);\n\n    // Hijack dimension properties\n    // This eliminates the timing issue between calling resize() and DOM update\n    /* eslint-disable accessor-pairs */\n    const {container} = props;\n    // $FlowFixMe\n    Object.defineProperty(container, 'offsetWidth', {get: () => this.width});\n    // $FlowFixMe\n    Object.defineProperty(container, 'clientWidth', {get: () => this.width});\n    // $FlowFixMe\n    Object.defineProperty(container, 'offsetHeight', {get: () => this.height});\n    // $FlowFixMe\n    Object.defineProperty(container, 'clientHeight', {get: () => this.height});\n\n    // Disable outline style\n    const canvas = this._map.getCanvas();\n    if (canvas) {\n      canvas.style.outline = 'none';\n    }\n\n    this._updateMapViewport({}, props);\n    this._updateMapSize({}, props);\n\n    this.props = props;\n  }\n\n  _update(oldProps: Props, newProps: Props) {\n    if (!this._map) {\n      return;\n    }\n\n    newProps = Object.assign({}, this.props, newProps);\n    checkPropTypes(newProps, 'Mapbox');\n\n    this._updateMapViewport(oldProps, newProps);\n    this._updateMapSize(oldProps, newProps);\n\n    this.props = newProps;\n  }\n\n  // Note: needs to be called after render (e.g. in componentDidUpdate)\n  _updateMapSize(oldProps: any, newProps: Props) {\n    const sizeChanged = oldProps.width !== newProps.width || oldProps.height !== newProps.height;\n    if (sizeChanged) {\n      this.width = newProps.width;\n      this.height = newProps.height;\n      this.resize();\n    }\n  }\n\n  _updateMapViewport(oldProps: any, newProps: Props) {\n    const oldViewState = this._getViewState(oldProps);\n    const newViewState = this._getViewState(newProps);\n\n    const viewportChanged =\n      newViewState.latitude !== oldViewState.latitude ||\n      newViewState.longitude !== oldViewState.longitude ||\n      newViewState.zoom !== oldViewState.zoom ||\n      newViewState.pitch !== oldViewState.pitch ||\n      newViewState.bearing !== oldViewState.bearing ||\n      newViewState.altitude !== oldViewState.altitude;\n\n    if (viewportChanged) {\n      this._map.jumpTo(this._getMapboxViewStateProps(newProps));\n\n      // TODO - jumpTo doesn't handle altitude\n      if (newViewState.altitude !== oldViewState.altitude) {\n        this._map.transform.altitude = newViewState.altitude;\n      }\n    }\n  }\n\n  _getViewState(props: Props) : ViewState {\n    const {\n      longitude,\n      latitude,\n      zoom,\n      pitch,\n      bearing,\n      altitude = 1.5\n    } = props.viewState || props;\n    return {longitude, latitude, zoom, pitch, bearing, altitude};\n  }\n\n  _checkStyleSheet(mapboxVersion : string = '0.47.0') {\n    if (typeof document === 'undefined') {\n      return;\n    }\n\n    // check mapbox styles\n    try {\n      const testElement = document.createElement('div');\n      testElement.className = 'mapboxgl-map';\n      testElement.style.display = 'none';\n      document.body.append(testElement);\n      const isCssLoaded = window.getComputedStyle(testElement).position !== 'static';\n\n      if (!isCssLoaded) {\n        // attempt to insert mapbox stylesheet\n        const link = document.createElement('link');\n        link.setAttribute('rel', 'stylesheet');\n        link.setAttribute('type', 'text/css');\n        link.setAttribute('href',\n          `https://api.tiles.mapbox.com/mapbox-gl-js/v${mapboxVersion}/mapbox-gl.css`);\n        document.head.append(link);\n      }\n    } catch (error) {\n      // do nothing\n    }\n  }\n\n  _getMapboxViewStateProps(props: Props) {\n    const viewState = this._getViewState(props);\n    return {\n      center: [viewState.longitude, viewState.latitude],\n      zoom: viewState.zoom,\n      bearing: viewState.bearing,\n      pitch: viewState.pitch\n    };\n  }\n}\n"],"file":"mapbox.js"}